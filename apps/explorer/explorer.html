<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Explorateur Pro ‚Äî PulseTech</title>
<style>
:root{
    --bg:#0d1117; --panel:#12151b; --muted:#9aa3c0; --accent:#6ea8fe; --glass: rgba(255,255,255,0.03);
    --card:#161927; --success:#3fc37b; --danger:#ff6b6b; --text:#e6eef8;
}
body{margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;align-items:stretch;padding:12px;gap:12px}
.container{display:flex;flex:1;gap:12px}
.sidebar{width:300px;background:linear-gradient(180deg,var(--panel),#0d1117);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(0,0,0,0.6);display:flex;flex-direction:column;gap:12px}
.brand{display:flex;justify-content:space-between;align-items:center}
.brand h1{font-size:16px;margin:0}
.small{font-size:13px;color:var(--muted)}
.search input{width:100%;padding:8px;border-radius:8px;border:none;background:var(--glass);color:var(--text)}
.folders{overflow:auto;padding-right:6px;margin-top:6px}
.folder{padding:8px 10px;border-radius:8px;cursor:pointer;color:var(--text);transition:all .12s;margin-bottom:6px;background:transparent}
.folder:hover{background:rgba(255,255,255,0.02);transform:translateY(-1px)}
.main{flex:1;display:flex;flex-direction:column;gap:12px}
.toolbar{display:flex;justify-content:space-between;align-items:center;gap:10px}
.lefttools{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(180deg,#2e3347,#202744);color:white}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
.breadcrumb{background:var(--glass);padding:8px 12px;border-radius:10px;color:var(--muted);display:inline-flex;gap:6px;align-items:center;max-width:60%}
.view{display:flex;gap:12px;flex:1;min-height:0}
.files{flex:1;background:linear-gradient(180deg,#0f1420,#0b0f16);border-radius:12px;padding:12px;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
.row{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;cursor:pointer;transition:all .12s}
.row:hover{background:rgba(255,255,255,0.02);transform:translateY(-2px)}
.row.selected{background:linear-gradient(90deg, rgba(110,168,254,0.10), rgba(110,168,254,0.02));box-shadow:inset 0 0 0 1px rgba(110,168,254,0.04)}
.icon{width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center}
.meta{display:flex;flex-direction:column;flex:1}
.name{font-weight:600}
.details{font-size:12px;color:var(--muted)}
.info{width:320px;background:linear-gradient(180deg,#0f1420,#0c1118);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
.info h4{margin:0 0 8px 0}
.infoRow{display:flex;justify-content:space-between;color:var(--muted);font-size:13px;padding:6px 0}
#contextMenu{position:absolute;display:none;background:var(--panel);padding:6px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.6);z-index:9999}
#contextMenu div{padding:8px 12px;cursor:pointer;border-radius:6px}
#contextMenu div:hover{background:rgba(255,255,255,0.02)}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:10000}
.card{width:95%;height:95%;background:var(--card);border-radius:12px;padding:12px;box-shadow:0 20px 60px rgba(0,0,0,0.7);display:flex;flex-direction:column}
.previewArea{flex:1;overflow:auto;background:#071021;border-radius:8px;padding:10px;color:#fff}
.editor{display:flex;gap:10px;height:100%}
textarea{flex:1;background:#071021;border-radius:8px;border:1px solid rgba(255,255,255,0.03);color:#e6eef8;padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono",monospace;font-size:13px;resize:none}
.lineNumbers{width:56px;padding:10px;background:rgba(255,255,255,0.02);color:var(--muted);overflow:auto;border-radius:8px}
.toastWrap{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:8px;z-index:10100}
.toast{background:#0b0f17;padding:10px 14px;border-radius:8px;border-left:4px solid var(--accent)}
.dropHint{border:2px dashed rgba(255,255,255,0.03);padding:14px;border-radius:12px;text-align:center;color:var(--muted);margin-bottom:10px}
/* Themes */
.theme-light{--bg:#f5f7fb;--panel:#ffffff;--text:#0b1220;--muted:#5b6a82;--accent:#1e88e5;--card:#ffffff}
.theme-rgb{--bg:linear-gradient(180deg,#071021,#0b0713);--panel:#071021;--accent:#ff66cc;--text:#f3f7ff}
.theme-pulse{--bg:#0f1220;--panel:#111323;--accent:#00d4ff;--text:#e6f7ff}
.theme-matrix{--bg:#04120a;--panel:#05180d;--accent:#33ff33;--text:#c7ffd1}
.theme-vscode{--bg:#1e1e2f;--panel:#222436;--accent:#007acc;--text:#e6eef8}
@media (max-width:920px){ .sidebar{display:none} .info{display:none} .card{width:96%} }
</style>
</head>
<body>
<div class="container" id="app">
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <div>
        <h1>Explorateur Pro</h1>
        <div class="small">PulseTech ‚Äî gestion fichiers</div>
      </div>
      <div>
        <select id="themeSelect" title="Choisir th√®me"></select>
      </div>
    </div>
    <div class="search">
      <input id="searchInput" placeholder="Rechercher fichiers / dossiers..." oninput="filterFiles()">
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn" onclick="createFolder()">üìÅ Nouveau dossier</button>
      <button class="btn ghost" onclick="createFile()">üìÑ Nouveau fichier</button>
    </div>
    <div class="folders" id="folderList" aria-live="polite"></div>
    <div class="small">Tip : clic droit pour options ‚Ä¢ Drag & drop pour uploader</div>
  </aside>

  <main class="main">
    <div class="toolbar">
      <div class="lefttools">
        <button class="btn" onclick="goBack()">‚¨Ö Retour</button>
        <div class="breadcrumb" id="breadcrumb">/</div>
        <input type="file" id="uploadInput" multiple style="display:none">
        <button class="btn ghost" onclick="document.getElementById('uploadInput').click()">üì§ Uploader</button>
        <button class="btn ghost" onclick="selectAllToggle()">S√©lectionner tout</button>
      </div>
      <div>
        <button class="btn" onclick="deleteSelected()" style="background:linear-gradient(180deg,#7c2a2a,#4c1616)">üóë Supprimer</button>
      </div>
    </div>

    <div class="view">
      <section class="files" id="fileList" ondragover="onDragOver(event)" ondrop="onDrop(event)">
        <div id="dropHint" class="dropHint">D√©posez les fichiers ici pour les uploader</div>
      </section>

      <aside class="info" id="infoPanel">
        <h4>Infos</h4>
        <div class="infoRow"><div class="small">Chemin</div><div id="infoPath">/</div></div>
        <div class="infoRow"><div class="small">√âl√©ment</div><div id="infoName">‚Äî</div></div>
        <div class="infoRow"><div class="small">Type</div><div id="infoType">‚Äî</div></div>
        <div class="infoRow"><div class="small">Taille</div><div id="infoSize">‚Äî</div></div>
        <div class="infoRow"><div class="small">Modifi√©</div><div id="infoDate">‚Äî</div></div>
        <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
          <button class="btn" id="openBtn" onclick="openSelected()">Ouvrir / Pr√©visualiser</button>
          <button class="btn ghost" id="renameBtn" onclick="renameSelected()">Renommer</button>
          <button class="btn ghost" id="downloadBtn" onclick="downloadSelected()">T√©l√©charger</button>
        </div>
      </aside>
    </div>
  </main>
</div>

<div id="contextMenu"><div onclick="openWith()">Ouvrir</div><div onclick="renameSelected()">Renommer</div><div onclick="deleteSelected()">Supprimer</div></div>

<div class="modal" id="previewModal">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <strong id="previewTitle">Pr√©visualisation</strong>
        <div class="small" id="previewSub"></div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn ghost" onclick="closePreview()">Fermer</button>
        <button class="btn" id="saveFileBtn" style="display:none" onclick="savePreviewEdits()">Enregistrer</button>
      </div>
    </div>
    <div id="previewArea" class="previewArea">Chargement...</div>
  </div>
</div>

<div class="toastWrap" id="toasts"></div>

<script>
const endpoints = {
  list: 'explorer.php?action=list',
  createFolder: 'explorer.php?action=createFolder',
  createFile: 'explorer.php?action=createFile',
  delete: 'explorer.php?action=delete',
  upload: 'explorer.php?action=upload',
  rename: 'explorer.php?action=rename',
  preview: 'explorer.php?action=preview',
  save: 'explorer.php?action=save'
};

let currentPath = '';
let previousPaths = [];
let items = [];
let selected = new Set();

/* ---------- Themes ---------- */
const themes = [
  {id:'vscode', label:'VS Code'},
  {id:'dark', label:'Sombre (par d√©faut)'},
  {id:'light', label:'Clair'},
  {id:'pulse', label:'PulseTech'},
  {id:'rgb', label:'RGB Gamer'},
  {id:'matrix', label:'Matrix'}
];
function initTheme(){
  const sel = document.getElementById('themeSelect');
  themes.forEach(t=>{ const o=document.createElement('option'); o.value=t.id; o.textContent=t.label; sel.appendChild(o); });
  const saved = localStorage.getItem('explorer_theme') || 'vscode';
  applyTheme(saved);
  sel.value = saved;
  sel.addEventListener('change', ()=>{ applyTheme(sel.value); localStorage.setItem('explorer_theme', sel.value); });
}
function applyTheme(id){
  document.body.className='theme-'+id;
}

/* ---------- Fetch / Render ---------- */
async function loadFolder(path=''){
  try{
    const res = await fetch(`${endpoints.list}&path=${encodeURIComponent(path)}`);
    const data = await res.json();
    currentPath = data.path;
    previousPaths.push(currentPath);
    items = data.items;
    renderFiles();
    updateBreadcrumb();
  }catch(e){console.error(e);}
}

function renderFiles(){
  const container = document.getElementById('fileList');
  container.innerHTML = '';
  items.forEach(it=>{
    const row = document.createElement('div');
    row.className='row';
    row.dataset.name = it.name;
    row.dataset.type = it.type;
    row.addEventListener('click', e=>{ if(!e.ctrlKey){selected.clear();} toggleSelect(row,it.name); updateInfo(it); });
    row.addEventListener('dblclick', ()=>{ if(it.type==='folder'){loadFolder(currentPath+'/'+it.name);} else {openPreview(it);} });
    const ic = document.createElement('div'); ic.className='icon'; ic.textContent=it.type==='folder'?'üìÅ':'üìÑ';
    const meta = document.createElement('div'); meta.className='meta';
    const nameEl = document.createElement('div'); nameEl.className='name'; nameEl.textContent=it.name;
    const detEl = document.createElement('div'); detEl.className='details'; detEl.textContent=it.size+' ‚Ä¢ '+it.modified;
    meta.appendChild(nameEl); meta.appendChild(detEl);
    row.appendChild(ic); row.appendChild(meta);
    if(selected.has(it.name)){row.classList.add('selected');}
    container.appendChild(row);
  });
}

function updateBreadcrumb(){
  document.getElementById('breadcrumb').textContent=currentPath||'/';
}

/* ---------- Selection ---------- */
function toggleSelect(el,name){
  if(selected.has(name)){selected.delete(name); el.classList.remove('selected');}
  else{selected.add(name); el.classList.add('selected');}
}

function selectAllToggle(){
  if(selected.size===items.length){selected.clear();}
  else{items.forEach(it=>selected.add(it.name));}
  renderFiles();
}

/* ---------- CRUD ---------- */
function createFolder(){
  const name = prompt('Nom du nouveau dossier :');
  if(!name) return;
  fetch(`${endpoints.createFolder}&path=${encodeURIComponent(currentPath)}&name=${encodeURIComponent(name)}`)
  .then(()=>loadFolder(currentPath));
}
function createFile(){
  const name = prompt('Nom du nouveau fichier :');
  if(!name) return;
  fetch(`${endpoints.createFile}&path=${encodeURIComponent(currentPath)}&name=${encodeURIComponent(name)}`)
  .then(()=>loadFolder(currentPath));
}
function deleteSelected(){
  if(!confirm('Confirmer la suppression ?')) return;
  fetch(endpoints.delete,{method:'POST',body:JSON.stringify({path:currentPath,items:[...selected]})})
  .then(()=>{ selected.clear(); loadFolder(currentPath); });
}
function renameSelected(){
  if(selected.size!==1){alert('S√©lectionnez un seul fichier pour renommer'); return;}
  const oldName=[...selected][0];
  const newName=prompt('Nouveau nom',oldName);
  if(!newName) return;
  fetch(`${endpoints.rename}`,{method:'POST',body:JSON.stringify({path:currentPath,oldName,newName})})
  .then(()=>loadFolder(currentPath));
}

/* ---------- Upload ---------- */
document.getElementById('uploadInput').addEventListener('change', async e=>{
  const files=e.target.files;
  const form=new FormData();
  for(const f of files){form.append('files[]',f);}
  form.append('path',currentPath);
  await fetch(endpoints.upload,{method:'POST',body:form});
  loadFolder(currentPath);
});
function onDragOver(e){e.preventDefault();}
function onDrop(e){
  e.preventDefault();
  const dt=e.dataTransfer.files;
  const form=new FormData();
  for(const f of dt){form.append('files[]',f);}
  form.append('path',currentPath);
  fetch(endpoints.upload,{method:'POST',body:form}).then(()=>loadFolder(currentPath));
}

/* ---------- Preview ---------- */
function openPreview(it){
  const modal=document.getElementById('previewModal');
  const area=document.getElementById('previewArea');
  document.getElementById('previewTitle').textContent=it.name;
  document.getElementById('previewSub').textContent=it.type;
  if(it.type==='folder'){area.textContent='Dossier ‚Äî double clic pour ouvrir';}
  else if(it.type==='image'){area.innerHTML=`<img src="${currentPath+'/'+it.name}" style="max-width:100%;max-height:100%;display:block;margin:auto"/>`;}
  else{area.innerHTML=`<iframe src="${currentPath+'/'+it.name}" style="width:100%;height:100%;border:none"></iframe>`;}
  modal.style.display='flex';
}
function closePreview(){document.getElementById('previewModal').style.display='none';}

/* ---------- Info Panel ---------- */
function updateInfo(it){
  document.getElementById('infoPath').textContent=currentPath;
  document.getElementById('infoName').textContent=it.name;
  document.getElementById('infoType').textContent=it.type;
  document.getElementById('infoSize').textContent=it.size||'‚Äî';
  document.getElementById('infoDate').textContent=it.modified||'‚Äî';
}
function openSelected(){
  if(selected.size!==1) return alert('S√©lectionnez un seul √©l√©ment');
  const name=[...selected][0];
  const it=items.find(x=>x.name===name);
  openPreview(it);
}
function downloadSelected(){
  if(selected.size!==1) return alert('S√©lectionnez un seul √©l√©ment');
  const name=[...selected][0];
  window.open(currentPath+'/'+name,'_blank');
}

/* ---------- Breadcrumb / Navigation ---------- */
function goBack(){ if(previousPaths.length>1){previousPaths.pop(); loadFolder(previousPaths.pop());} }

/* ---------- Filter ---------- */
function filterFiles(){
  const q=document.getElementById('searchInput').value.toLowerCase();
  items.forEach(it=>{
    const el=document.querySelector(`.row[data-name="${it.name}"]`);
    if(!el) return;
    el.style.display=it.name.toLowerCase().includes(q)?'flex':'none';
  });
}

/* ---------- Init ---------- */
initTheme();
loadFolder('');
</script>
</body>
</html>
